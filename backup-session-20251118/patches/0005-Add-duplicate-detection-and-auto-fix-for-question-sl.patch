From aef559a64ff026e33457c95a28fb4aa61b8ad260 Mon Sep 17 00:00:00 2001
From: Claude <noreply@anthropic.com>
Date: Tue, 18 Nov 2025 21:02:26 +0000
Subject: [PATCH 5/6] Add duplicate detection and auto-fix for question slugs

---
 scripts/import-categories.js | 30 ++++++++++++++++++++++++++++++
 1 file changed, 30 insertions(+)

diff --git a/scripts/import-categories.js b/scripts/import-categories.js
index 8d84af7..bf4203f 100644
--- a/scripts/import-categories.js
+++ b/scripts/import-categories.js
@@ -236,6 +236,36 @@ async function importCategories() {
       });
     });
 
+    // Debug: Zkontroluj duplicity
+    const duplicateCheck = {};
+    const duplicates = [];
+    allQuestions.forEach(q => {
+      const key = `${q.section_id}::${q.slug}`;
+      if (duplicateCheck[key]) {
+        duplicates.push({ key, question: q.question_text });
+      }
+      duplicateCheck[key] = (duplicateCheck[key] || 0) + 1;
+    });
+
+    if (duplicates.length > 0) {
+      console.log('âš ï¸  Nalezeny duplicitnÃ­ otÃ¡zky:');
+      duplicates.forEach(d => console.log(`  - ${d.key}: ${d.question}`));
+      console.log('\nðŸ”§ Opravuji duplicity pÅ™idÃ¡nÃ­m UUID sufixu...\n');
+
+      // Oprav duplicity pÅ™idÃ¡nÃ­m unique sufixu
+      const seen = {};
+      allQuestions.forEach(q => {
+        const key = `${q.section_id}::${q.slug}`;
+        if (seen[key]) {
+          // PÅ™idej counter k slugu
+          seen[key]++;
+          q.slug = `${q.slug}-${seen[key]}`;
+        } else {
+          seen[key] = 1;
+        }
+      });
+    }
+
     const { data: insertedQuestions, error: qError } = await supabase
       .from('lifepro_questions')
       .upsert(allQuestions, { onConflict: 'section_id,slug' })
-- 
2.43.0

